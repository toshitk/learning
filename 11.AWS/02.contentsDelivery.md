# 2. ネットワーキングとコンテンツ配信
## 2.1. CloudFront
### CloudFrontとは
- CloudFrontはHTMLやCSS、画像、動画といった静的コンテンツをキャッシュし、オリジンサーバの代わりに配信するCDN(Contents Delivery Network)サービス
- 120を超えるエッジロケーションが存在し、CloudFrontを使用するとｍ利用者から最も近いエッジロケーションからコンテンツを配信することができる
  - 動画等のサイズの大きなコンテンツへのアクセスの度にオリジンサーバーが処理すると負荷が高くなるため使用する

### オリジンサーバ(バックエンドサーバ)
- 元となるコンテンツを保持するサーバ
- ELB, EC2, S3、オンプレのサーバがオリジンサーバとして利用可能
  - オンプレのサーバも利用可能なため、システム構成変更なしでCloudFrontを使用可能

### ディストリビューション
- コンテンツによって異なる2つのディストリビューションが存在する
- ダウンロードディストリビューション
  - HTTPやHTTPSを使ってHTMLやCSS、画像等のデータを配信する際に使用
- ストリーミングディストリビューション
  - RTMP(Real Time Messaging Protcol)を使って動画を配信する際に使用

### キャッシュルール
- 拡張子やURLパスごとにキャッシュ期間を指定することが可能
- 頻繁に変更されるHTML等のコンテンツはキャッシュ期間を短く、あまり変更されない画像、動画等のコンテンツは長くする等の設定が可能

## 2.2. Route 53
### Route 53とは
- ドメイン管理機能やと権威DNS機能を持つサービス
- Route 53は権威DNSなのでキャッシュDNSは別に用意する必要がある

### ドメイン管理
- 新規ドメインの取得/更新、ゾーン情報の設定等が可能
  - ドメインの自動更新機能もあるため、更新漏れにも対応
- ドメインの利用料はAWS利用料に含まれる

### ホストゾーンとレコード情報
- ホストゾーンはレコード情報の管理単位を意味する(通常はドメイン名)
  - e.g.
    - `example.co.jpのレコード情報を管理する場合のホストゾーンはexample.co.jp`
    - レコード情報はwww.example.co.jpのIPアドレスは192.168.0.100であるといった、ドメイン名とIPアドレスを変換するための情報
- Route 53の特徴的なレコードとして`Aliasレコード`がある
  - Aliasレコードはレコード情報に登録する値としてCloudFrontやELB、S3等のAWSリソースのFQDNを指定可能
  - `Zone Apex`にも登録できる点で、CNAMEとは異なる
- Zone Apex
  - DNSの方に加筆
  - Zone Apexとはサブドメインを含まない最上位ドメイン(Route 53の場合はホストゾーン名)
  - CNAMEは登録できない

### トラフィックルーティング
- Route 53では名前解決の問い合わせに対してどのように応答するかを決める7種類のルーティングポリシーが存在する

|ポリシー|概要|
|---|---|
|シンプルルーティングポリシー|標準的な1対1のルーティング|
|フェイルオーバールーティングポリシー|A/S方式でActive側へのヘルスチェックが失敗した時にStanby側へルーティングする<br>障害時にSorryサーバへルーティングする場合等に使用|
|位置情報ルーティングポリシー|ユーザのいち情報に基づいてルーティングする<br>日本からのアクセス時には日本語コンテンツを表示する場合等に使用|
|地理的近接性ルーティングポリシー|リソースの場所に基づいてルーティングする<br>参考：[AWS公式](https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/routing-policy.html#routing-policy-geoproximity)|
|レイテンシールーティングポリシー|サーバが分散配置されている場合に、遅延が最も少ないサーバへルーティングする<br>特定サーバだけ高負荷になった場合等に使用|
|複数値回答ルーティングポリシー|1つのレコードにIPアドレスを複数登録して、ヘルスチェックに成功したIPアドレスから、ランダムなアドレスにルーティングする<br>|
|加重ルーティングポリシー|指定した比率で複数のリソースへルーティングする<br>拠点をまたがってリソースが配置されている場合やABテストを実施する際等に使用|

### トラフィックフロー
- ルーティングポリシーを組み合わせることで様々なルーティングが可能だが、設定が複雑となることがある
- トラフィックフローは上記の組み合わせを視覚的に分かりやすく組み合わせるためのツール
