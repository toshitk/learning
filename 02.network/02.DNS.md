# DNS

## DNSとは
- Domain Name Systemの略で名前解決を行う

## HOSTS.TXT
- ARPANET(米国国防総省が作ったインターネットの前身)では、ホスト名とIPアドレスの対応表として`HOSTS.TXT`というテキストファイルを使用していた
  - HOST.TXTを集中管理するSRI-NETから最新のHOST.TXTを入手して自分のホストに入れることで名前解決を行っていた
  - 新しく追加する場合はSRI-NETにメールで追加依頼を行い、SRI-NETは更新/公開を行う
- ホスト数の増加に伴い下記が起こるようになった
  - HOSTS.TXTの肥大化
  - 更新/公開作業量の増大
  - SRI-NETのサーバの負荷増大

## DNS
- Domain Name Systemの略
- 名前をドメインと呼ばれる階層構造で管理する分散型データベース
- これによって、ファイルの肥大化や更新作業の集中を防止
- 最上位にルートサーバがあり、TLD(Top Level Domain)サーバがどこにあるかを管理している
  - TLD: `jp`や`com`など一番上位のドメイン名
- TLDサーバはそれぞれの空間で管理される名前のDNSサーバがどこにあるか管理する
  - `jp`のDNSサーバは`example.jpやco.jp`等について管理

```
ルートサーバ
├ jp
│ ├ example.jp
│ ├ co.jp
│ ...├ example.co.jp
│    ... 
│
├ com
│ ├ 
│ ├
│ ...
│
├ uk
│ ├
│ ├
│ ...
...
```

- Authoritative DNS(権威DNS)サーバ
  - それぞれのドメイン名に関する情報を保持するDNSサーバ
- Cache DNS(参照DNS)サーバ
  - クライアントからの名前解決の問い合わせを受け、代理で権威DNSサーバへ再帰的に問い合わせを行うサーバ(① - ⑧)
  - 問い合わせ結果を一定期間保存し、同じ問い合わせが来た時は自ら返答する(①、⑧)

![](./image/02-1.authoritativeDNS.png)

- ゾーン
  - 1台の権威DNSサーバが管理する範囲をゾーンと呼び、ゾーンの名前解決を行うための情報をゾーン情報と呼ぶ
  - ゾーン情報はDNSレコードから構成される
- DNSレコード

|レコード種別|概要|
|---|---|
|A|ホストのIPアドレス(AddressのA)|
|CNAME|ドメイン名のエイリアス(CanonicalのC)|
|MX|ドメインのメールサーバ|

- e.g. 
  - 1台のサーバで複数のサービスを提供している場合に、サービスごとにサーバーの名前を変えるときにCNAMEを使用
  - サーバの正式なドメイン名は`service.example.jp`だが、情報提供では`info.example.jp`を、ショッピングでは`shop.example.jp`というドメイン名で運用する
  - 上記のような場合、CNAMEリソースレコードを用いて下記のように定義する

|||||
|---|---|---|---|
|service.example.jp|IN|A|192.0.2.100|
||IN|A|192.0.2.101|
|info.example.jp|IN|CNAME|service.example.jp|
|shop.example.jp|IN|CNAME|service.example.jp|
